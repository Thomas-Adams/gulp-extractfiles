animations = [{
    /* 0 */
    outClass: 'moveToLeft',
    inClass: 'moveFromRight'
}, {
    /* 1 */
    outClass: 'moveToRight',
    inClass: 'moveFromLeft'
}, {
    /* 2 */
    outClass: 'moveToTop',
    inClass: 'moveFromBottom'
}, {
    /* 3 */
    outClass: 'moveToBottom',
    inClass: 'moveFromTop'
}, {
    /* 4 */
    outClass: 'fade',
    inClass: 'moveFromRight ontop'
}, {
    /* 5 */
    outClass: 'fade',
    inClass: 'moveFromLeft ontop'
}, {
    /* 6 */
    outClass: 'fade',
    inClass: 'moveFromBottom ontop'
}, {
    /* 7 */
    outClass: 'fade',
    inClass: 'moveFromTop ontop'
}, {
    /* 8 */
    outClass: 'moveToLeftFade',
    inClass: 'moveFromRightFade'
}, {
    /* 9 */
    outClass: 'moveToRightFade',
    inClass: 'moveFromLeftFade'
}, {
    /* 10 */
    outClass: 'moveToTopFade',
    inClass: 'moveFromBottomFade'
}, {
    /* 11 */
    outClass: 'moveToBottomFade',
    inClass: 'moveFromTopFade'
}, {
    /* 12 */
    outClass: 'moveToLeftEasing ontop',
    inClass: 'moveFromRight'
}, {
    /* 13 */
    outClass: 'moveToRightEasing ontop',
    inClass: 'moveFromLeft'
}, {
    /* 14 */
    outClass: 'moveToTopEasing ontop',
    inClass: 'moveFromBottom'
}, {
    /* 15 */
    outClass: 'moveToBottomEasing ontop',
    inClass: 'moveFromTop'
}, {
    /* 16 */
    outClass: 'scaleDown',
    inClass: 'moveFromRight ontop'
}, {
    /* 17 */
    outClass: 'scaleDown',
    inClass: 'moveFromLeft ontop'
}, {
    /* 18 */
    outClass: 'scaleDown',
    inClass: 'moveFromBottom ontop'
}, {
    /* 19 */
    outClass: 'scaleDown',
    inClass: 'moveFromTop ontop'
}, {
    /* 20 */
    outClass: 'scaleDown',
    inClass: 'scaleUpDown delay300'
}, {
    /* 21 */
    outClass: 'scaleDownUp',
    inClass: 'scaleUp delay300'
}, {
    /* 22 */
    outClass: 'moveToLeft ontop',
    inClass: 'scaleUp'
}, {
    /* 23 */
    outClass: 'moveToRight ontop',
    inClass: 'scaleUp'
}, {
    /* 24 */
    outClass: 'moveToTop ontop',
    inClass: 'scaleUp'
}, {
    /* 25 */
    outClass: 'moveToBottom ontop',
    inClass: 'scaleUp'
}, {
    /* 26 */
    outClass: 'scaleDownCenter',
    inClass: 'scaleUpCenter delay400'
}, {
    /* 27 */
    outClass: 'rotateRightSideFirst',
    inClass: 'moveFromRight delay200 ontop'
}, {
    /* 28 */
    outClass: 'rotateLeftSideFirst',
    inClass: 'moveFromLeft delay200 ontop'
}, {
    /* 29 */
    outClass: 'rotateTopSideFirst',
    inClass: 'moveFromTop delay200 ontop'
}, {
    /* 30 */
    outClass: 'rotateBottomSideFirst',
    inClass: 'moveFromBottom delay200 ontop'
}, {
    /* 31 */
    outClass: 'flipOutRight',
    inClass: 'flipInLeft delay500'
}, {
    /* 32 */
    outClass: 'flipOutLeft',
    inClass: 'flipInRight delay500'
}, {
    /* 33 */
    outClass: 'flipOutTop',
    inClass: 'flipInBottom delay500'
}, {
    /* 34 */
    outClass: 'flipOutBottom',
    inClass: 'flipInTop delay500'
}, {
    /* 35 */
    outClass: 'rotateFall ontop',
    inClass: 'scaleUp'
}, {
    /* 36 */
    outClass: 'rotateOutNewspaper',
    inClass: 'rotateInNewspaper delay500'
}, {
    /* 37 */
    outClass: 'rotatePushLeft',
    inClass: 'moveFromRight'
}, {
    /* 38 */
    outClass: 'rotatePushRight',
    inClass: 'moveFromLeft'
}, {
    /* 39 */
    outClass: 'rotatePushTop',
    inClass: 'moveFromBottom'
}, {
    /* 40 */
    outClass: 'rotatePushBottom',
    inClass: 'moveFromTop'
}, {
    /* 41 */
    outClass: 'rotatePushLeft',
    inClass: 'rotatePullRight delay180'
}, {
    /* 42 */
    outClass: 'rotatePushRight',
    inClass: 'rotatePullLeft delay180'
}, {
    /* 43 */
    outClass: 'rotatePushTop',
    inClass: 'rotatePullBottom delay180'
}, {
    /* 44 */
    outClass: 'rotatePushBottom',
    inClass: 'rotatePullTop delay180'
}, {
    /* 45 */
    outClass: 'rotateFoldLeft',
    inClass: 'moveFromRightFade'
}, {
    /* 46 */
    outClass: 'rotateFoldRight',
    inClass: 'moveFromLeftFade'
}, {
    /* 47 */
    outClass: 'rotateFoldTop',
    inClass: 'moveFromBottomFade'
}, {
    /* 48 */
    outClass: 'rotateFoldBottom',
    inClass: 'moveFromTopFade'
}, {
    /* 49 */
    outClass: 'moveToRightFade',
    inClass: 'rotateUnfoldLeft'
}, {
    /* 50 */
    outClass: 'moveToLeftFade',
    inClass: 'rotateUnfoldRight'
}, {
    /* 51 */
    outClass: 'moveToBottomFade',
    inClass: 'rotateUnfoldTop'
}, {
    /* 52 */
    outClass: 'moveToTopFade',
    inClass: 'rotateUnfoldBottom'
}, {
    /* 53 */
    outClass: 'rotateRoomLeftOut ontop',
    inClass: 'rotateRoomLeftIn'
}, {
    /* 54 */
    outClass: 'rotateRoomRightOut ontop',
    inClass: 'rotateRoomRightIn'
}, {
    /* 55 */
    outClass: 'rotateRoomTopOut ontop',
    inClass: 'rotateRoomTopIn'
}, {
    /* 56 */
    outClass: 'rotateRoomBottomOut ontop',
    inClass: 'rotateRoomBottomIn'
}, {
    /* 57 */
    outClass: 'rotateCubeLeftOut ontop',
    inClass: 'rotateCubeLeftIn'
}, {
    /* 58 */
    outClass: 'rotateCubeRightOut ontop',
    inClass: 'rotateCubeRightIn'
}, {
    /* 59 */
    outClass: 'rotateCubeTopOut ontop',
    inClass: 'rotateCubeTopIn'
}, {
    /* 60 */
    outClass: 'rotateCubeBottomOut ontop',
    inClass: 'rotateCubeBottomIn'
}, {
    /* 61 */
    outClass: 'rotateCarouselLeftOut ontop',
    inClass: 'rotateCarouselLeftIn'
}, {
    /* 62 */
    outClass: 'rotateCarouselRightOut ontop',
    inClass: 'rotateCarouselRightIn'
}, {
    /* 63 */
    outClass: 'rotateCarouselTopOut ontop',
    inClass: 'rotateCarouselTopIn'
}, {
    /* 64 */
    outClass: 'rotateCarouselBottomOut ontop',
    inClass: 'rotateCarouselBottomIn'
}, {
    /* 65 */
    outClass: 'rotateSidesOut',
    inClass: 'rotateSidesIn delay200'
}, {
    /* 66 */
    outClass: 'rotateSlideOut',
    inClass: 'rotateSlideIn'
}];

var animEndEventNames = {
    'WebkitAnimation': 'webkitAnimationEnd',
    'OAnimation': 'oAnimationEnd',
    'msAnimation': 'MSAnimationEnd',
    'animation': 'animationend'
};

function onEndAnimation($outpage, $inpage) {
    endCurrPage = false;
    endNextPage = false;
    isAnimating = false;
    resetPage($outpage, $inpage);
}

function resetPage($outpage, $inpage) {
    $outpage.attr('class', $outpage.data('originalClassList'));
    $inpage.attr('class', $inpage.data('originalClassList') + ' current');
}

var handleFileComplete = function(evt) {
    $("[data-src='" + evt.item.src + "']").attr("src", evt.item.src);
    if ($("[data-src='" + evt.item.src + "']").hasClass("main")) {
        $("[data-src='" + evt.item.src + "']").parent().focusPoint("adjustFocus");
    }
    loadedImages += 1;
    var percentLoaded = Math.round(loadedImages / numOfImages * 100, 0);
    return true;
};

var handleComplete = function(evt) {
    $(".lazy.main").parent().focusPoint("adjustFocus");
    $(".lazy.main").css("opacity", 1);
    $("div.overlay").hide();
    $currentPage = $pages.eq(current);
    $currentPage.addClass('current');
    //animationIndex = $currentPage.data('animation');
};

var numOfImages = 0,
    loadedImages = 0,
    pagesCount = 0,
    current = 0,
    wh = window.innerHeight,
    $currentPage = null,
    $nextPage = null,
    animationIndex = 59,
    isAnimating = false,
    endCurrPage = false,
    endNextPage = false,
    support = Modernizr.cssanimations,
    animEndEventName = animEndEventNames[Modernizr.prefixed('animation')];


function navigateTo(targetPageIndex) {
    var idx = parseInt(targetPageIndex.substring(1), 10) - 1;
    if (isAnimating === true) {
        return;
    }
    isAnimating = true;
    $currentPage = $pages.eq(current);
    current = idx;
    $nextPage = $pages.eq(current).addClass('current');
    $currentPage.addClass(animations[animationIndex].outClass).on(animEndEventName, function() {

        try {
            $currentPage.off(animEndEventName);
            endCurrPage = true;
            if (endNextPage) {
                onEndAnimation($currentPage, $nextPage);
            }
        } catch (err) {
            aler(err);
        }

    });


    $nextPage.addClass(animations[animationIndex].inClass).on(animEndEventName, function() {

        try {
            $nextPage.off(animEndEventName);
            endNextPage = true;
            if (endCurrPage) {
                onEndAnimation($currentPage, $nextPage);
            }
        } catch (err) {
            aler(err);
        }

    });

    if (!support) {
        onEndAnimation($currPage, $nextPage);
    }
}


$(document).ready(function() {
    $overlay = $("div.overlay");
    $overlay.height(wh).css('width', '100%');
    $main = $("div.container-fluid");
    $pages = $main.children("section");
    pagesCount = $pages.length;
    $('.focuspoint').focusPoint();
    var images = $(".lazy").map(function() {
        return $(this).attr('data-src');
    }).get();
    $pages.each(function(index, elem) {
        var $page = $(elem);
        $page.height(wh).data('originalClassList', $page.attr('class'));
    });
    numOfImages = images.length;

    var preload = new createjs.LoadQueue(true);
    preload.setMaxConnections(10);
    preload.on("fileload", handleFileComplete, this);
    preload.on("complete", handleComplete, this);
    preload.loadManifest(images);

    $("#navToggle").click(function() {
        $("#cbp-spmenu-s1").toggleClass("cbp-spmenu-open");
    });

    $("#navClose").click(function() {
        $("#cbp-spmenu-s1").toggleClass("cbp-spmenu-open");
    });

    $('.js-accordion-trigger').bind('click', function(e) {
        $(this).parent().find('.submenu').slideToggle('fast'); // apply the toggle to the ul
        $('li.is-expanded').not($(this).parent()).removeClass('is-expanded').find('.submenu').slideToggle('fast');
        $(this).parent().toggleClass('is-expanded');
        e.preventDefault();
    });

    $("ul.submenu a").click(function(ev) {
        ev.preventDefault();
        var id = $(this).attr('id');
        $("#cbp-spmenu-s1").toggleClass("cbp-spmenu-open");
        navigateTo(id);
    });

    $pages.each(function(index, elem) {
        var $page = $(elem);
        $page.swipe({
            swipe: function(event, direction, distance, duration, fingercount, fingerData) {
                if (isAnimating === true) {
                    return;
                }
                isAnimating = true;
                $currentPage = $pages.eq(current);
                if (direction === 'down') {
                    if (current < pagesCount - 1) {
                        current++;
                    } else {
                        current = 0;
                    }
                    $nextPage = $pages.eq(current).addClass('current');
                    $currentPage.addClass(animations[animationIndex].outClass).on(animEndEventName, function() {

                        try {
                            $currentPage.off(animEndEventName);
                            endCurrPage = true;
                            if (endNextPage) {
                                onEndAnimation($currentPage, $nextPage);
                            }
                        } catch (err) {
                            aler(err);
                        }

                    });


                    $nextPage.addClass(animations[animationIndex].inClass).on(animEndEventName, function() {

                        try {
                            $nextPage.off(animEndEventName);
                            endNextPage = true;
                            if (endCurrPage) {
                                onEndAnimation($currentPage, $nextPage);
                            }
                        } catch (err) {
                            aler(err);
                        }

                    });
                }
                if (direction === 'up') {
                    if (current > 0) {
                        current--;
                    } else {
                        current = 0;
                    }
                    $nextPage = $pages.eq(current).addClass('current');
                    $nextPage.addClass(animations[animationIndex].inClass).on(animEndEventName, function() {

                        try {
                            $nextPage.off(animEndEventName);
                            endNextPage = true;
                            if (endCurrPage) {
                                onEndAnimation($currentPage, $nextPage);
                            }
                        } catch (err) {
                            aler(err);
                        }

                    });
                    $currentPage.addClass(animations[animationIndex].outClass).on(animEndEventName, function() {

                        try {
                            $currentPage.off(animEndEventName);
                            endCurrPage = true;
                            if (endNextPage) {
                                onEndAnimation($currentPage, $nextPage);
                            }
                        } catch (err) {
                            aler(err);
                        }

                    });



                }



                if (!support) {
                    onEndAnimation($currPage, $nextPage);
                }
            }
        });
    });
});
